@if (visible) {
<div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2 class="modal-title">{{ translationService.translate('SHOP_TITLE') }}</h2>
            <button class="close-btn" (click)="closeModal()">{{ translationService.translate('CLOSE') }}</button>
        </div>

        <h3 class="subtitle">Select a Sector to Upgrade:</h3>
        <div class="wheel-selector-container">
            <svg class="preview-wheel-svg" [attr.width]="wheelSize" [attr.height]="wheelSize"
                [attr.viewBox]="'0 0 ' + wheelSize + ' ' + wheelSize">
                <g>
                    @for (sector of sectors; track sector.id; let i = $index) {
                    <g class="sector-group" [class.selected]="selectedSector?.id === sector.id"
                        (click)="selectSector(sector)">
                        <path [attr.d]="getSectorPath(i)" [attr.fill]="sector.color" class="sector-path" />
                        <text [attr.x]="getLabelPosition(i).x" [attr.y]="getLabelPosition(i).y"
                            [attr.transform]="'rotate(' + getLabelPosition(i).rotation + ' ' + getLabelPosition(i).x + ' ' + getLabelPosition(i).y + ')'"
                            fill="#f5f5f5" font-size="12" font-weight="bold" text-anchor="middle"
                            dominant-baseline="middle" class="sector-text">
                            {{ sector.label }}
                        </text>
                    </g>
                    }
                    <circle [attr.cx]="radius" [attr.cy]="radius" r="15" fill="#0a0a0f" stroke="var(--color-primary)"
                        stroke-width="2" />
                </g>
            </svg>

            @if (selectedSector) {
            <div class="selected-sector-info">
                <span class="info-label">SELECTED:</span>
                <span class="info-value" [style.color]="selectedSector.color">{{ selectedSector.label }}</span>
                @if (selectedSector.weight > 1) {
                <span class="info-weight">Weight: {{ selectedSector.weight }}</span>
                }
                @if (selectedSector.shardProbability) {
                <span class="info-shards">üíé: {{ (selectedSector.shardProbability * 100).toFixed(1) }}%</span>
                }
            </div>
            }
        </div>

        @if (selectedSector) {
        <h3 class="subtitle">Available Upgrades:</h3>
        <div class="upgrade-list">
            @for (upgrade of upgrades; track upgrade.id) {
            <button class="upgrade-item" [class.disabled]="!canBuy(upgrade)" [disabled]="!canBuy(upgrade)"
                (click)="buyUpgrade(upgrade)" [title]="upgrade.description || ''">
                <div class="upgrade-info">
                    <div class="icon-container" [style.background-color]="hexToRgba(upgrade.color)">
                        <div class="icon" [style.color]="upgrade.color">
                            @if (upgrade.type === 'mult') { üìà }
                            @if (upgrade.type === 'color') { üé® }
                            @if (upgrade.type === 'weight') { ‚öñÔ∏è }
                            @if (upgrade.type === 'shard') { üíé }
                        </div>
                    </div>
                    <div>
                        <div class="upgrade-name">{{ upgrade.name }}</div>
                        <div class="upgrade-cost">{{ upgrade.cost }} Chips</div>
                        @if (upgrade.description) {
                        <div class="upgrade-desc">{{ upgrade.description }}</div>
                        }
                    </div>
                </div>
                <span class="chevron">‚Ä∫</span>
            </button>
            }
        </div>
        }

        @if (!selectedSector) {
        <div class="empty-state">
            <p class="empty-text">Pick a slice of the wheel above to start modifying</p>
        </div>
        }
    </div>
</div>
}