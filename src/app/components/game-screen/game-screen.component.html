@if (gameState) {
<div class="game-container">
    <div class="header">
        <div class="stat-box">
            <span class="icon">ðŸ’°</span>
            <span class="stat-text">{{ gameState.chips }}</span>
            <button class="debug-chips-btn" (click)="addWinningChips()" title="Debug: +1000 Chips">
                <span class="icon">âž•</span>
            </button>
        </div>

        <div class="title-container">
            <h1 class="title neon-glow">{{ translationService.translate('TITLE') }}</h1>
            <div class="meta-stats">
                <span class="meta-item">ðŸ’Ž {{ gameState.metaCurrency }} {{ translationService.translate('SHARDS')
                    }}</span>
                <button class="skin-shop-btn" (click)="openSkinShop()" title="Skin Shop">
                    ðŸŽ¨
                </button>
                <button class="lang-toggle" (click)="translationService.toggleLanguage()">
                    {{ translationService.getLanguage().toUpperCase() }}
                </button>
            </div>
        </div>

        <div class="progression-box">
            <div class="ante-info">
                <span class="label">{{ translationService.translate('ANTE') }}</span>
                <span class="value">{{ gameState.currentAnte }}</span>
            </div>
            <div class="blind-info" [attr.data-type]="gameState.blindState.type">
                <span class="value">{{ translationService.translate(gameState.blindState.type + '_BLIND') }}</span>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <!-- Left Column: Wheel and Result -->
        <div class="layout-left">
            <div class="wheel-wrapper">
                <app-roulette-wheel [sectors]="gameState.sectors" [skin]="activeSkinData"
                    (spinComplete)="onSpinComplete($event)">
                </app-roulette-wheel>

                <div class="win-container" [class.show]="showWinAnimation && gameState.lastWin > 0">
                    @if (gameState.lastWin > 0) {
                    <div class="win-text" [class.big-win]="gameState.lastWin >= 50">
                        +{{ gameState.lastWin }}
                    </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column: Stats, Modifiers, and Controls -->
        <div class="layout-right">
            <div class="round-stats">
                <div class="score-progress">
                    <div class="progress-labels">
                        <span class="current">{{ translationService.translate('SCORE') }}: {{
                            gameState.blindState.currentScore }}</span>
                        <span class="target">{{ translationService.translate('TARGET') }}: {{
                            gameState.blindState.targetScore }}</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar"
                            [style.width.%]="(gameState.blindState.currentScore / gameState.blindState.targetScore) * 100">
                        </div>
                    </div>
                </div>

                <div class="spins-counter">
                    <span class="label">{{ translationService.translate('SPINS_LEFT') }}</span>
                    <span class="value" [class.low]="gameState.blindState.spinsRemaining <= 1">
                        {{ gameState.blindState.spinsRemaining }}
                    </span>
                </div>
            </div>

            <!-- NEW: Joker/Amulet Modifiers Row -->
            <div class="modifiers-row">
                @for (joker of gameState.jokers; track joker.id) {
                <div class="modifier-container">
                    <div class="modifier-slot filled" [attr.data-rarity]="joker.rarity" [title]="joker.description">
                        <img [src]="joker.icon" [alt]="joker.name" class="modifier-icon">
                    </div>
                    <span class="modifier-label">{{ joker.name }}</span>
                </div>
                }

                <!-- Empty slots up to max (e.g., 5 total) -->
                @for (i of getEmptySlots(); track i) {
                <div class="modifier-slot empty" (click)="openJokerShop()">
                    <span class="empty-icon">+</span>
                </div>
                }
            </div>

            <div class="footer">
                <app-bet-selector></app-bet-selector>

                <div class="controls">
                    <button class="spin-button"
                        [disabled]="isSpinning || gameState.blindState.spinsRemaining <= 0 || gameState.blindState.currentScore >= gameState.blindState.targetScore || gameState.chips < gameState.selectedBet"
                        (click)="handleSpin()">
                        {{ translationService.translate('SPIN') }} ({{gameState.selectedBet}})
                    </button>
                </div>

                <div class="upgrade-teaser">
                    <button class="upgrade-card" (click)="openShop()">
                        <span class="upgrade-icon">ðŸ“ˆ</span>
                        <span class="upgrade-title">{{ translationService.translate('UPGRADE_SECTOR') }}</span>
                    </button>
                    <button class="upgrade-card">
                        <span class="upgrade-icon">ðŸ”„</span>
                        <span class="upgrade-title">{{ translationService.translate('NEW_WHEEL') }}</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shop and Modals -->
    <app-upgrade-shop [visible]="gameState.isShopOpen" [sectors]="gameState.sectors" [chips]="gameState.chips"
        (close)="closeShop()">
    </app-upgrade-shop>

    <app-joker-shop [visible]="isJokerShopVisible" [chips]="gameState.chips"
        [activeJokerCount]="gameState.jokers.length" (close)="closeJokerShop()" (jokerPurchased)="onJokerPurchased()">
    </app-joker-shop>

    <app-game-over-modal [visible]="gameState.isGameOver" [stats]="gameState.runStats" (restart)="closeGameOver()">
    </app-game-over-modal>

    @if (isSkinShopVisible) {
    <app-skin-shop (close)="closeSkinShop()"></app-skin-shop>
    }
</div>
}